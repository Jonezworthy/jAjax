var jAjaxSettings={minPriority:1,maxPriority:10,defaultPriority:1,defaultMethod:"get",defaultCacheTime:300,maxConnections:3,patrolFrequency:500};var jAjax=function(d){var c={};for(var b in d){c[b]=d[b]}c.method=typeof d.method!=="undefined"?d.method:jAjaxSettings.defaultMethod;c.priority=typeof d.priority!=="undefined"&&d.priority<jAjaxSettings.maxPriority?d.priority:jAjaxSettings.defaultPriority;c.cacheTime=typeof d.cacheTime!=="undefined"?d.cacheTime:jAjaxSettings.defaultCacheTime;if(c.url){var a=new jAjaxCache(c.url,c.cacheTime);if(c.cacheTime===0||c.cacheTime===false||!a.checkCache()){if(typeof window.jAjaxQueue!=="object"){window.jAjaxQueue={ready:{amount:0},active:{amount:0},complete:{amount:0}}}if(typeof window.jAjaxQueue.ready[c.priority]!=="object"){window.jAjaxQueue.ready[c.priority]={}}window.jAjaxQueue.ready["amount"]++;window.jAjaxQueue.ready[c.priority][c.url]=c}else{if(typeof d.success==="function"){d.success(a.getContent(),d)}if(typeof d.isCached==="function"){d.isCached(a.getContent(),a.getCacheData())}}}};var jAjaxCache=function(b,a){this.url=b;this.cacheTime=a;this.checkCache=function(){if(this.url&&localStorage&&JSON&&localStorage.getItem(this.url)){var d=JSON.parse(localStorage.getItem(this.url));if(d.url&&d.dateTime&&d.content&&d.cacheLimit){var f=new Date(d.dateTime);var c=new Date();var e=Math.ceil(((c.getTime()-f.getTime())/1000));if(e<d.cacheLimit){return true}else{return false}}else{localStorage.removeItem(this.url)}}else{return false}};this.getContent=function(){if(localStorage&&JSON){var c=JSON.parse(localStorage.getItem(this.url));if(c){return c.content||""}}};this.getCacheData=function(){if(localStorage&&JSON){return JSON.parse(localStorage.getItem(this.url))}};this.storeContent=function(c){if(localStorage&&JSON){try{if(localStorage.getItem(this.url)){localStorage.removeItem(this.url)}if(parseInt(a)!==0&&c.toString().length>0){localStorage.setItem(this.url,JSON.stringify({url:this.url,cacheLimit:a,dateTime:new Date().toString(),content:c}))}}finally{return false}}}};var jAjaxQueueController=function(){var i=typeof jAjaxSettings.maxPriority!=="undefined"?jAjaxSettings.maxPriority:10;var j=typeof jAjaxSettings.minPriority!=="undefined"?jAjaxSettings.minPriority:1;var b=typeof jAjaxSettings.maxConnections!=="undefined"?jAjaxSettings.maxConnections:3;var h={processRequest:function(l,n){var k=window.jAjaxQueue.active[l][n];var m=new XMLHttpRequest();m.open(k.method,k.url,true);m.send();m.onreadystatechange=function(){if(m.status===200&&m.readyState===4){jAjaxQueueController().changeStatus("active","complete",k.priority,k.url);if(typeof k.success==="function"){if(k.cacheTime>0){oJajaxCache=new jAjaxCache(k.url,k.cacheTime);oJajaxCache.storeContent(m.responseText)}k.success(m.responseText,k,m)}}else{if(m.readyState===4){console.log("Ajax response: "+m.status)}}}},changeStatus:function(l,m,k,n){window.jAjaxQueue[l]["amount"]--;window.jAjaxQueue[m]["amount"]++;if(typeof window.jAjaxQueue[m][k]!=="object"){window.jAjaxQueue[m][k]={}}window.jAjaxQueue[m][k][n]=window.jAjaxQueue[l][k][n];window.jAjaxQueue[m][k][n]["changedDateTime"]=new Date();delete window.jAjaxQueue[l][k][n]}};for(var f=i;f>=j;f--){for(var e in window.jAjaxQueue.ready[f]){if(typeof window.jAjaxQueue.ready[f][e]==="object"){if(window.jAjaxQueue.active["amount"]<b||f===i){h.changeStatus("ready","active",f,e);h.processRequest(f,e)}}}for(var e in window.jAjaxQueue.active[f]){var g=window.jAjaxQueue.active[f][e]["changedDateTime"];var a=new Date();var d=Math.ceil((a.getTime()-g.getTime())/1000);for(var c in window.jAjaxQueue.active[f][e]["waiting"]){if(c<=d){if(typeof window.jAjaxQueue.active[f][e]["waiting"][c]==="function"){window.jAjaxQueue.active[f][e]["waiting"][c](d);delete window.jAjaxQueue.active[f][e]["waiting"][c]}}}}}return h};(function(){var a=setInterval(function(){if(window.jAjaxQueue){document.getElementById("readyAmount").innerHTML="ready amount: "+window.jAjaxQueue.ready["amount"];document.getElementById("activeAmount").innerHTML="active amount: "+window.jAjaxQueue.active["amount"];document.getElementById("completeAmount").innerHTML="complete amount: "+window.jAjaxQueue.complete["amount"];document.getElementById("maxConnections").innerHTML="max connections allowed in settings:"+jAjaxSettings.maxConnections;new jAjaxQueueController()}},jAjaxSettings.patrolFrequency||200)})();jAjax({url:"ajaxMe.php",method:"get",priority:10,cacheTime:900,isCached:function(a,b){},passthrough:true,waiting:{5:function(a){},10:function(a){}},success:function(b,c,a){}});